//This handler is responsible for all requests relating to the main page of the website
//for example: serving html of the main page and editing it based on who is logged in
let users = require("./Users.js");
let games = require("./Games.js");
const express = require('express');

let router = express.Router();



//------------------------------------------------------------------------
//------------------------------------------------------------------------
//----------------------GET REQUESTS -------------------------------------
//------------------------------------------------------------------------
//------------------------------------------------------------------------
router.get("*", serveIndex);

function serveIndex(req, res, next){
    if(!req.session.loggedin){
        res.render("pages/index.ejs", {playerID:null, gameIDs:[], enemyIDs:[], friendsList:[]});
        return;
    }
    
    //serves the html for the index page, modified for the user
    let gameIDs = users.getUserById(req.session.playerID).activeGames;
    let enemyIDs = users.getIDsOfAllOpponents(req.session.playerID);

    res.render("pages/index.ejs", {playerID:req.session.playerID, gameIDs, enemyIDs, 
                                   friendsList:req.session.friendsList});
}
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------
//----------------------END OF GET REQUESTS --------------------------------
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//------------------------------------------------------------------------
//------------------------------------------------------------------------
//----------------------POST REQUESTS -------------------------------------
//------------------------------------------------------------------------
//------------------------------------------------------------------------
router.post("*", (req, res, next) => {next("Index Router received a POST request that it cannot handle!");});
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------
//----------------------END OF POST REQUESTS --------------------------------
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//------------------------------------------------------------------------
//------------------------------------------------------------------------
//----------------------PUT REQUESTS -------------------------------------
//------------------------------------------------------------------------
//------------------------------------------------------------------------
router.put("*", (req, res, next) => {next("Index Router received a PUT request that it cannot handle!");});
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------
//----------------------END OF PUT REQUESTS --------------------------------
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------



//------------------------------------------------------------------------
//------------------------------------------------------------------------
//----------------------DELETE REQUESTS -------------------------------------
//------------------------------------------------------------------------
//------------------------------------------------------------------------
router.delete("*", (req, res, next) => {next("Index Router received a DELETE request that it cannot handle!");});
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------
//----------------------END OF DELETE REQUESTS --------------------------------
//--------------------------------------------------------------------------
//--------------------------------------------------------------------------

module.exports = router;